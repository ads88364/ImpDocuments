<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å€’æ•¸ç¬¬ä¸‰æ®µé‡è¤‡æª¢æŸ¥</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      padding: 30px;
    }
    .ok { color: green; font-weight: bold; }
    .ng { color: red; font-weight: bold; }
    table {
      border-collapse: collapse;
      margin-top: 20px;
      width: 100%;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
    }
    th {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>
  <h2>ğŸ“ è³‡æ–™å¤¾åç¨±å€’æ•¸ç¬¬ä¸‰æ®µé‡è¤‡æª¢æŸ¥</h2>
  <input type="file" id="folderPicker" webkitdirectory directory multiple />
  <div id="result"></div>
  <div id="tableContainer"></div>

  <script>
    document.getElementById("folderPicker").addEventListener("change", function () {
      const files = this.files;
      const resultDiv = document.getElementById("result");
      const tableContainer = document.getElementById("tableContainer");
      resultDiv.innerHTML = "";
      tableContainer.innerHTML = "";

      const folderNames = new Set();

      // ğŸ” æ”¶é›†æ‰€æœ‰è³‡æ–™å¤¾åç¨±
      for (const file of files) {
        const parts = file.webkitRelativePath.split("/"); // æ‹†æˆè·¯å¾‘é™£åˆ—
        if (parts.length >= 2) {
          folderNames.add(parts[0]); // å–ç¬¬ä¸€å±¤è³‡æ–™å¤¾åç¨±ï¼ˆçˆ¶è³‡æ–™å¤¾ä¸­çš„å­è³‡æ–™å¤¾ï¼‰
        }
      }

      const seen = {};
      const duplicates = [];

      [...folderNames].forEach((folderName) => {
        const parts = folderName.split("_");
        if (parts.length < 3) return;

        const key = parts[parts.length - 3]; // å€’æ•¸ç¬¬ä¸‰æ®µ
        if (!seen[key]) {
          seen[key] = [];
        }
        seen[key].push(folderName);
      });

      Object.entries(seen).forEach(([key, folders]) => {
        if (folders.length > 1) {
          duplicates.push({ key, folders });
        }
      });

      if (duplicates.length === 0) {
        resultDiv.innerHTML = `<p class="ok">âœ… æ²’æœ‰é‡è¤‡çš„å€’æ•¸ç¬¬ä¸‰æ®µ</p>`;
      } else {
        resultDiv.innerHTML = `<p class="ng">âŒ ç™¼ç¾ ${duplicates.length} çµ„é‡è¤‡çš„å€’æ•¸ç¬¬ä¸‰æ®µ</p>`;

        const table = document.createElement("table");
        const thead = document.createElement("thead");
        const tbody = document.createElement("tbody");

        const headerRow = document.createElement("tr");
        ["é‡è¤‡å€¼", "å‡ºç¾æ–¼è³‡æ–™å¤¾"].forEach(text => {
          const th = document.createElement("th");
          th.textContent = text;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);

        duplicates.forEach(item => {
          const tr = document.createElement("tr");

          const tdKey = document.createElement("td");
          tdKey.textContent = item.key;
          tr.appendChild(tdKey);

          const tdFolders = document.createElement("td");
          tdFolders.textContent = item.folders.join(", ");
          tr.appendChild(tdFolders);

          tbody.appendChild(tr);
        });

        table.appendChild(thead);
        table.appendChild(tbody);
        tableContainer.appendChild(table);
      }
    });
  </script>
</body>
</html>
